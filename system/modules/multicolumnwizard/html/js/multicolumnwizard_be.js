var MultiColumnWizard=new Class({Implements:[Options],options:{table:null,maxCount:0,minCount:0,uniqueFields:[]},operationLoadCallbacks:[],operationClickCallbacks:[],operationUpdateCallbacks:[],initialize:function(a){this.setOptions(a);this.options.table=document.id(this.options.table);if(window.Backend){Backend.getScrollOffset()}var b=this;this.options.table.getElement("tbody").getChildren("tr").each(function(c,d){c.getChildren("td.operations a").each(function(f){var e=f.get("data-operations");if(MultiColumnWizard.operationLoadCallbacks[e]){MultiColumnWizard.operationLoadCallbacks[e].each(function(g){g.pass([f,c],b)()})}if(b.operationLoadCallbacks[e]){b.operationLoadCallbacks[e].each(function(g){g.pass([f,c],b)()})}})});this.updateOperations()},updateOperations:function(){var a=this;this.options.table.getElement("tbody").getChildren("tr").each(function(b,c){b.getChildren("td.operations a").each(function(e){var d=e.get("data-operations");e.removeEvents("click");if(d==="move"){a.dragAndDrop(b,e)}if(MultiColumnWizard.operationClickCallbacks[d]){MultiColumnWizard.operationClickCallbacks[d].each(function(f){e.addEvent("click",function(g){g.preventDefault();f.pass([e,b],a)()})})}if(a.operationClickCallbacks[d]){a.operationClickCallbacks[d].each(function(f){e.addEvent("click",function(g){g.preventDefault();f.pass([e,b],a)();a.updateFields(c)})})}e.addEvent("click",function(f){f.preventDefault();a.updateOperations.pass([e,b],a)()});if(MultiColumnWizard.operationUpdateCallbacks[d]){MultiColumnWizard.operationUpdateCallbacks[d].each(function(f){f.pass([e,b],a)()})}if(a.operationUpdateCallbacks[d]){a.operationUpdateCallbacks[d].each(function(f){f.pass([e,b],a)()})}})})},updateRowAttributes:function(f,g){var a=true;var d=0;var e=0;var c=0;var b=0;g.getElements(".mcwUpdateFields *").each(function(h){if(h.hasClass("tl_modulewizard")&&h.hasClass("multicolumnwizard")){a=false;d++;h.addClass("mcw_inner_"+d);c=h.getElement("tbody").getElement("tr").getElements("td.mcwUpdateFields").length;b=1}if(d!==0&&(!h.hasClass("tl_modulewizard")||!h.hasClass("multicolumnwizard"))&&h.getParent(".mcw_inner_"+d)===null){d--;if(d===0){a=true}}if(h.hasClass("chzn-container")){h.destroy();return}if(typeOf(h.getProperty("name"))=="string"){var o=h.getProperty("name");var l=o.match(/([^[\]]+)/g);var j=null;var m="";l.each(function(r,s){if(!isNaN(parseFloat(r))&&isFinite(r)){j=s}});l.each(function(r,s){if(s===0){m+=r}else{if(s===j&&a){m+="["+f+"]"}else{if(s===(j-2)&&!a){m+="["+f+"]"}else{if(s===j&&!a){m+="["+e+"]";e=((b>0)&&(b%c)==0)?++e:e;b++}else{m+="["+r+"]"}}}}});if(o.substr(o.length-2)=="[]"){m+="[]"}h.setProperty("name",m)}if(typeOf(h.getProperty("id"))=="string"){var i=h.getProperty("id").match(/^(.+)_row[0-9]+_(.+)$/i);if(i){h.setProperty("id",i[1]+"_row"+f+"_"+i[2])}}if(typeOf(h.getProperty("onclick"))=="string"){var i=h.getProperty("onclick").match(/^(.+)_row[0-9]+_(.+)$/i);if(i){h.setProperty("onclick",i[1]+"_row"+f+"_"+i[2])}}if(typeOf(h.getProperty("for"))=="string"){var i=h.getProperty("for").match(/^(.+)_row[0-9]+_(.+)$/i);if(i){h.setProperty("for",i[1]+"_row"+f+"_"+i[2])}}switch(h.nodeName.toUpperCase()){case"SELECT":if(h.hasClass("tl_chosen")){new Chosen(h)}break;case"INPUT":if(h.getStyle("display").toLowerCase()=="none"){h.setStyle("display","inline")}if(typeOf(h.getProperty("id"))!="string"){h.destroy()}break;case"SCRIPT":var n="";var p=h.get("html").toString();var k=0;var q=p.search(/_row[0-9]+_/i);while(q>0){k=p.match(/(_row[0-9]+)+_/i)[0].length;n=n+p.substr(0,q)+"_row"+f+"_";p=p.substr(q+k);q=p.search(/_row[0-9]+_/i)}h.set("html",n+p);break}});return g},dragAndDrop:function(b,a){new Sortables(b.getParent("table").getElement("tbody"),{constrain:true,opacity:0.6,handle:"a[data-operations=move]",onComplete:function(){b.getParent("table").getElement("tbody").getChildren("tr").each(function(c,d){var e=d--;this.updateRowAttributes(e,c)},this)}.bind(this)})},addOperationLoadCallback:function(b,a){if(!this.operationLoadCallbacks[b]){this.operationLoadCallbacks[b]=[]}this.operationLoadCallbacks[b].include(a)},addOperationUpdateCallback:function(b,a){if(!this.operationUpdateCallbacks[b]){this.operationUpdateCallbacks[b]=[]}this.operationLoadCallbacks[b].include(a)},addOperationClickCallback:function(b,a){if(!this.operationClickCallbacks[b]){this.operationClickCallbacks[b]=[]}this.operationClickCallbacks[b].include(a)},killAllTinyMCE:function(c,g){var f=g.getParent(".multicolumnwizard");if(f.getElements(".tinymce").length==0){return}var d=f.get("id");var e=new RegExp(d);var h=new Array();var a=0;var b="editorId";if(tinymce.majorVersion>3){b="id"}tinymce.editors.each(function(j,i){if(j[b].match(e)!=null){h[a]=j[b];a++}});h.each(function(l,k){try{var j=tinymce.get(l);$(j[b]).set("text",j.getContent());j.remove()}catch(i){console.log(i)}});f.getElements("span.mceEditor").each(function(j,i){j.dispose()});f.getElements(".tinymce").each(function(j,i){j.getElements("script").each(function(l,k){l.dispose()})})},reinitTinyMCE:function(b,e,c){var d=null;if(c!=true){d=e.getParent(".multicolumnwizard")}else{d=e}if(d.getElements(".tinymce").length==0){return}var f=d.getElements(".tinymce textarea");var a="mceAddControl";if(tinymce.majorVersion>3){a="mceAddEditor"}f.each(function(h,g){tinymce.execCommand(a,false,h.get("id"));tinymce.get(h.get("id")).show();$(h.get("id")).erase("required");$(tinymce.get(h.get("id")).editorContainer).getElements("iframe")[0].set("title","MultiColumnWizard - TinyMCE")})},reinitStylect:function(){if(window.Stylect){if(versionCompare("3.2.3")>=0){$$(".styled_select").each(function(b,a){b.dispose()});Stylect.convertSelects()}}}});Object.append(MultiColumnWizard,{operationLoadCallbacks:{},operationClickCallbacks:{},operationUpdateCallbacks:{},addOperationLoadCallback:function(b,a){if(!MultiColumnWizard.operationLoadCallbacks[b]){MultiColumnWizard.operationLoadCallbacks[b]=[]}MultiColumnWizard.operationLoadCallbacks[b].include(a)},addOperationUpdateCallback:function(b,a){if(!MultiColumnWizard.operationUpdateCallbacks[b]){MultiColumnWizard.operationUpdateCallbacks[b]=[]}MultiColumnWizard.operationUpdateCallbacks[b].include(a)},addOperationClickCallback:function(b,a){if(!MultiColumnWizard.operationClickCallbacks[b]){MultiColumnWizard.operationClickCallbacks[b]=[]}MultiColumnWizard.operationClickCallbacks[b].include(a)},newUpdate:function(a,b){var c=b.getSiblings().length+1;if(this.options.maxCount>0&&c>=this.options.maxCount){a.setStyle("display","none")}else{a.setStyle("display","inline")}},newClick:function(b,c){this.killAllTinyMCE(b,c);var d=c.getSiblings().length+1;if(this.options.maxCount==0||(this.options.maxCount>0&&d<this.options.maxCount)){var a=c.clone(true,true);a.getElements("input,select,textarea").each(function(f){MultiColumnWizard.clearElementValue(f)});level=c.getAllPrevious().length;a=this.updateRowAttributes(++level,a);a.inject(c,"after");a.getElements("a[data-operations]").each(function(f){$$(f).set("title",$$(f).getElement("img").get("alt"));new Tips.Contao($$(f).filter(function(g){return g.title!=""}),{offset:{x:0,y:26}})});if(a.getElements("script").length>0){a.getElements("script").each(function(f){Browser.exec(f.get("html"))})}var e=this;a.getAllNext().each(function(f){e.updateRowAttributes(++level,f)})}this.reinitTinyMCE(b,c,false);this.reinitStylect()},copyUpdate:function(a,b){var c=b.getSiblings().length+1;if(this.options.maxCount>0&&c>=this.options.maxCount){a.setStyle("display","none")}else{a.setStyle("display","inline")}},copyClick:function(b,c){this.killAllTinyMCE(b,c);var d=c.getSiblings().length+1;if(this.options.maxCount==0||(this.options.maxCount>0&&d<this.options.maxCount)){var a=c.clone(true,true);level=c.getAllPrevious().length;a=this.updateRowAttributes(++level,a);a.inject(c,"after");a.getElements("a[data-operations]").each(function(f){$$(f).set("title",$$(f).getElement("img").get("alt"));new Tips.Contao($$(f).filter(function(g){return g.title!=""}),{offset:{x:0,y:26}})});if(a.getElements("script").length>0){a.getElements("script").each(function(f){Browser.exec(f.get("html"))})}var e=this;a.getAllNext().each(function(f){e.updateRowAttributes(++level,f)})}this.reinitTinyMCE(b,c,false);this.reinitStylect()},deleteUpdate:function(a,b){var c=b.getSiblings().length+1;if(this.options.minCount>0&&c<=this.options.minCount){a.setStyle("display","none")}else{a.setStyle("display","inline")}},deleteClick:function(a,c){this.killAllTinyMCE(a,c);var b=c.getParent(".multicolumnwizard");if(c.getSiblings().length>0){var d=c.getAllNext();level=c.getAllPrevious().length;c.dispose();c.destroy.delay(10,c);var e=this;d.each(function(f){e.updateRowAttributes(level++,f)})}else{c.getElements("input,select,textarea").each(function(f){MultiColumnWizard.clearElementValue(f)})}this.reinitTinyMCE(a,b,true)},upClick:function(a,d){this.killAllTinyMCE(a,d);var b=d.getPrevious();if(b){var c=b.getAllPrevious().length;b=this.updateRowAttributes(99999,b);d=this.updateRowAttributes(c,d);b=this.updateRowAttributes(c+1,b);d.inject(b,"before")}this.reinitTinyMCE(a,d,false)},downClick:function(a,c){this.killAllTinyMCE(a,c);var b=c.getNext();if(b){var d=c.getAllPrevious().length;c=this.updateRowAttributes(99999,c);b=this.updateRowAttributes(d,b);c=this.updateRowAttributes(d+1,c);c.inject(b,"after")}this.reinitTinyMCE(a,c,false)},clearElementValue:function(a){if(a.get("type")=="checkbox"||a.get("type")=="radio"){a.checked=false}else{a.set("value","")}}});MultiColumnWizard.addOperationUpdateCallback("new",MultiColumnWizard.newUpdate);MultiColumnWizard.addOperationClickCallback("new",MultiColumnWizard.newClick);MultiColumnWizard.addOperationUpdateCallback("copy",MultiColumnWizard.copyUpdate);MultiColumnWizard.addOperationClickCallback("copy",MultiColumnWizard.copyClick);MultiColumnWizard.addOperationUpdateCallback("delete",MultiColumnWizard.deleteUpdate);MultiColumnWizard.addOperationClickCallback("delete",MultiColumnWizard.deleteClick);MultiColumnWizard.addOperationClickCallback("up",MultiColumnWizard.upClick);MultiColumnWizard.addOperationClickCallback("down",MultiColumnWizard.downClick);(function(a){if(!a){return}a.openModalSelectorOriginal=a.openModalSelector;a.openModalSelector=function(d){a.openModalSelectorOriginal(d);var b=null;var f=60;var c=new URI(d.url).getData("field")+"_parent";var e=setInterval(function(){f-=1;var g=window.frames;for(var h=0;h<g.length;h++){if(g[h].name=="simple-modal-iframe"){b=g[h];break}}if(b&&b.document.getElementById(c)){b.document.getElementById(c).set("id",d.id+"_parent");clearInterval(e);return}if(f<=0){clearInterval(e)}},500)}})(window.Backend);versionCompare=function(g){var h=$("top").get("class").match(/version_[^\s]*/);h=h[0];h=h.replace("version_","");h=h.split("-").join(".");if(typeof h!=="string"){return false}if(typeof g+typeof h!="stringstring"){return false}var c=g.split("."),d=h.split("."),e=0,f=Math.max(c.length,d.length);for(;e<f;e++){if((c[e]&&!d[e]&&parseInt(c[e])>0)||(parseInt(c[e])>parseInt(d[e]))){return 1}else{if((d[e]&&!c[e]&&parseInt(d[e])>0)||(parseInt(c[e])<parseInt(d[e]))){return -1}}}return 0};