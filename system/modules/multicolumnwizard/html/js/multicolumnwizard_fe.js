var MultiColumnWizard=new Class({Implements:[Options],options:{table:null,maxCount:0,minCount:0,uniqueFields:[]},operationLoadCallbacks:[],operationClickCallbacks:[],initialize:function(a){this.setOptions(a);this.options.table=document.id(this.options.table);if(window.Backend){Backend.getScrollOffset()}this.updateOperations()},updateOperations:function(){var a=this;this.options.table.getElement("tbody").getElements("tr").each(function(c,b){c.getElement("td.operations").getElements("a").each(function(d){var e=d.get("rel");if(MultiColumnWizard.operationLoadCallbacks[e]){MultiColumnWizard.operationLoadCallbacks[e].each(function(f){f.pass([d,c],a)()})}if(a.operationLoadCallbacks[e]){a.operationLoadCallbacks[e].each(function(f){f.pass([d,c],a)()})}d.removeEvents("click");if(MultiColumnWizard.operationClickCallbacks[e]){MultiColumnWizard.operationClickCallbacks[e].each(function(f){d.addEvent("click",function(g){g.preventDefault();f.pass([d,c],a)()})})}if(a.operationClickCallbacks[e]){a.operationClickCallbacks[e].each(function(f){d.addEvent("click",function(g){g.preventDefault();f.pass([d,c],a)();a.updateFields(b)})})}})})},updateRowAttributes:function(b,a){a.getElements(".mcwUpdateFields *[name]").each(function(c){if(typeOf(c.getProperty("name"))=="string"){var d=c.getProperty("name").match(/^([^\[]+)\[([0-9]+)\](.*)$/i);if(d){c.setProperty("name",d[1]+"["+b+"]"+d[3])}}if(typeOf(c.getProperty("id"))=="string"){var d=c.getProperty("id").match(/^(.+)_row[0-9]+_(.+)$/i);if(d){c.setProperty("id",d[1]+"_row"+b+"_"+d[2])}}});a.getElements(".mcwUpdateFields label").each(function(c){if(typeOf(c.getProperty("for"))=="string"){var d=c.getProperty("for").match(/^(.+)_row[0-9]+_(.+)$/i);if(d){c.setProperty("for",d[1]+"_row"+b+"_"+d[2])}}});return a},addOperationLoadCallback:function(a,b){if(!this.operationLoadCallbacks[a]){this.operationLoadCallbacks[a]=[]}this.operationLoadCallbacks[a].include(b)},addOperationClickCallback:function(a,b){if(!this.operationClickCallbacks[a]){this.operationClickCallbacks[a]=[]}this.operationClickCallbacks[a].include(b)}});Object.append(MultiColumnWizard,{operationLoadCallbacks:{},operationClickCallbacks:{},addOperationLoadCallback:function(a,b){if(!MultiColumnWizard.operationLoadCallbacks[a]){MultiColumnWizard.operationLoadCallbacks[a]=[]}MultiColumnWizard.operationLoadCallbacks[a].include(b)},addOperationClickCallback:function(a,b){if(!MultiColumnWizard.operationClickCallbacks[a]){MultiColumnWizard.operationClickCallbacks[a]=[]}MultiColumnWizard.operationClickCallbacks[a].include(b)},copyLoad:function(b,c){var a=c.getSiblings().length+1;if(this.options.maxCount>0&&a==this.options.maxCount){b.destroy()}},copyClick:function(b,c){var a=c.getSiblings().length+1;if(this.options.maxCount==0||(this.options.maxCount>0&&a<this.options.maxCount)){++a;var d=c.clone(true,true);d=this.updateRowAttributes(a-1,d);d.inject(c,"after");this.addOperationClickCallback("click",this.updateOperations)}if(this.options.maxCount>0&&a==this.options.maxCount){b.destroy()}},deleteLoad:function(b,c){var a=b.getAllPrevious().length-1;if(this.options.minCount>0&&a==this.options.minCount){b.destroy()}},deleteClick:function(a,b){b.destroy()},upClick:function(b,d){var c=d.getPrevious();if(c){var a=c.getAllPrevious().length;c=this.updateRowAttributes(99999,c);d=this.updateRowAttributes(a,d);c=this.updateRowAttributes(a+1,c);d.inject(c,"before")}},downClick:function(c,d){var b=d.getNext();if(b){var a=d.getAllPrevious().length;d=this.updateRowAttributes(99999,d);b=this.updateRowAttributes(a,b);d=this.updateRowAttributes(a+1,d);d.inject(b,"after")}}});MultiColumnWizard.addOperationLoadCallback("copy",MultiColumnWizard.copyLoad);MultiColumnWizard.addOperationClickCallback("copy",MultiColumnWizard.copyClick);MultiColumnWizard.addOperationLoadCallback("delete",MultiColumnWizard.deleteLoad);MultiColumnWizard.addOperationClickCallback("delete",MultiColumnWizard.deleteClick);MultiColumnWizard.addOperationClickCallback("up",MultiColumnWizard.upClick);MultiColumnWizard.addOperationClickCallback("down",MultiColumnWizard.downClick);