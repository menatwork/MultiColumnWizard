var MultiColumnWizard={execHOOK:Array(),execute:function(e,g,h){var f=$(h);var b=f.getFirst().getNext();var d=$(e).getParent("tr");var a={maxCount:f.getProperty("rel").match(/maxCount\[[0-9]+\]/ig)[0].replace("maxCount[","").replace("]","").toInt(),minCount:f.getProperty("rel").match(/minCount\[[0-9]+\]/ig)[0].replace("minCount[","").replace("]","").toInt(),uniqueFields:f.getProperty("rel").match(/unique\[[a-z0-9,]*\]/ig)[0].replace("unique[","").replace("]","").split(",")};if(window.Backend){Backend.getScrollOffset()}MultiColumnWizard[g](b,d,a);b.getElements("input[type=radio], input[type=checkbox]").each(function(k,j){if(typeof k.get("name")=="string"){k.set("name",k.get("name")+"DUMMYNAME"+j)}});b.getChildren().each(function(k,j){MultiColumnWizard.updateFields(k.getChildren(),j)});b.getElements("input[type=radio], input[type=checkbox]").each(function(k,j){if(typeof k.get("name")=="string"){k.set("name",k.get("name").replace("DUMMYNAME"+j,""))}});for(var c=0;c<MultiColumnWizard.execHOOK.length;c++){MultiColumnWizard.execHOOK[c](e,g,h)}},copy:function(b,f,a){var h=new Element("tr");var g=f.getChildren();for(var c=0;c<g.length;c++){var e=g[c].clone(true,true).injectInside(h);e.getFirst().value=g[c].getFirst().value}h.injectAfter(f);if(a.maxCount<=b.getChildren().length&&a.maxCount!=0){b.getElements("img[src=system/themes/default/images/copy.gif]").getParent().setStyle("display","none")}if(a.minCount<b.getChildren().length&&a.minCount!=0){b.getElements("img[src=system/themes/default/images/delete.gif]").getParent().setStyle("display","inline")}if(a.uniqueFields.length>1||a.uniqueFields[0]!=""){for(var c=0;c<a.uniqueFields.length;c++){var d=h.getElements("*[name*=["+a.uniqueFields[c]+"]]");if(d){MultiColumnWizard.clearElementValue(d)}}}},up:function(b,c,a){c.getPrevious()?c.injectBefore(c.getPrevious()):c.injectInside(b)},down:function(b,c,a){c.getNext()?c.injectAfter(c.getNext()):c.injectBefore(b.getFirst())},"delete":function(b,d,a){if(b.getChildren().length>1){d.destroy()}else{var e=d.getElements("input,select,textarea");for(var c=0;c<e.length;c++){MultiColumnWizard.clearElementValue(e[c])}}if(a.maxCount>b.getChildren().length){b.getElements("img[src=system/themes/default/images/copy.gif]").getParent().setStyle("display","inline")}if(a.minCount>=b.getChildren().length){b.getElements("img[src=system/themes/default/images/delete.gif]").getParent().setStyle("display","none")}},updateFields:function(a,b){a.each(function(c){if(c.getChildren().length>0){MultiColumnWizard.updateFields(c.getChildren(),b)}if(typeof c.get("name")=="string"){var d=c.get("name").match(/^([^\[]+)\[([0-9]+)\](.*)$/i);if(d){c.set("name",d[1]+"["+b+"]"+d[3])}}if(typeof c.get("id")=="string"){var d=c.get("id").match(/^(.+)_row[0-9]+_(.+)$/i);if(d){c.set("id",d[1]+"_row"+b+"_"+d[2])}}if(typeof c.get("for")=="string"){var d=c.get("for").match(/^(.+)_row[0-9]+_(.+)$/i);if(d){c.set("for",d[1]+"_row"+b+"_"+d[2])}}})},clearElementValue:function(a){if(a.get("type")=="checkbox"||a.get("type")=="radio"){a.checked=false}else{a.set("value","")}},attachDatepicker:function(d,f,c){if(f!="copy"){return}var j=$(c).getProperty("rel").match(/datepicker\[[a-z0-9,]*\]/ig)[0].replace("datepicker[","").replace("]","").split(",");var k=$(c).getElement("tbody").getChildren();if(j.length>1||j[0]!=""){for(var g=0;g<j.length;g++){var a=[];for(var b=0;b<k.length;b++){var e=c+"_row"+b+"_"+j[g];document.id(e).setStyle("display","inline-block").getNext().destroy();a.include(e)}var h=c.replace("ctrl_","datepicker_")+"_"+j[g];window[h].attachTo="#"+a.join(",#");window[h].options.toggleElements="#"+a.join(",#").replace(/ctrl_/g,"toggle_");window[h].attach()}}}};MultiColumnWizard.execHOOK.push(MultiColumnWizard.attachDatepicker);